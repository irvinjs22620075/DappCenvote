---
// Demo page showing Passkey + Freighter integration
import Layout from '../layouts/Layout.astro';
import PasskeyConnector from '../components/PasskeyConnector.astro';
import WalletConnector from '../components/WalletConnector.astro';
---

<Layout title="CenVote - Passkey & Freighter Demo">
  <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <!-- Header -->
    <nav class="bg-white shadow-lg border-b-4 border-indigo-600">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <h1 class="text-2xl font-bold text-indigo-600">üîê CenVote Demo</h1>
          </div>
          <div class="flex items-center gap-4">
            <a href="/" class="text-gray-600 hover:text-indigo-600 font-medium">‚Üê Back</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Demo Section -->
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Left: Passkey Authentication -->
        <div class="space-y-6">
          <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 px-6 py-4">
              <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                üì± Passkey Authentication
              </h2>
            </div>
            <PasskeyConnector title="WebAuthn Passkey" showDebug={true} />
            <div class="px-6 py-4 border-t text-sm text-gray-600">
              <p><strong>What's a Passkey?</strong></p>
              <ul class="mt-2 space-y-1 list-disc list-inside">
                <li>Biometric (fingerprint, face) or device PIN</li>
                <li>No passwords needed</li>
                <li>Works with Soroban contracts for __check_auth</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Right: Freighter Wallet -->
        <div class="space-y-6">
          <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-orange-600 to-yellow-600 px-6 py-4">
              <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                ü™ê Freighter Wallet
              </h2>
            </div>
            <WalletConnector />
            <div class="px-6 py-4 border-t text-sm text-gray-600">
              <p><strong>About Freighter</strong></p>
              <ul class="mt-2 space-y-1 list-disc list-inside">
                <li>Stellar wallet browser extension</li>
                <li>Sign XLM transactions</li>
                <li>Works with Soroban contracts</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- How It Works Section -->
      <div class="mt-12 bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-6">üîÑ How It Works Together</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Step 1 -->
          <div class="relative">
            <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-600 text-white font-bold text-lg">
              1
            </div>
            <h3 class="mt-4 text-lg font-medium text-gray-900">User Registers Passkey</h3>
            <p class="mt-2 text-sm text-gray-600">
              User creates a passkey using biometric or PIN. The public key is stored in your Soroban contract.
            </p>
          </div>

          <!-- Arrow -->
          <div class="hidden md:flex items-center justify-center">
            <div class="text-3xl text-indigo-400">‚Üí</div>
          </div>

          <!-- Step 2 -->
          <div class="relative">
            <div class="flex items-center justify-center h-12 w-12 rounded-md bg-blue-600 text-white font-bold text-lg">
              2
            </div>
            <h3 class="mt-4 text-lg font-medium text-gray-900">User Connects Wallet</h3>
            <p class="mt-2 text-sm text-gray-600">
              User approves Freighter wallet connection. The wallet can now sign transactions on Stellar.
            </p>
          </div>

          <!-- Arrow -->
          <div class="hidden md:flex items-center justify-center">
            <div class="text-3xl text-indigo-400">‚Üí</div>
          </div>

          <!-- Step 3 -->
          <div class="relative">
            <div class="flex items-center justify-center h-12 w-12 rounded-md bg-orange-600 text-white font-bold text-lg">
              3
            </div>
            <h3 class="mt-4 text-lg font-medium text-gray-900">Sign Transaction</h3>
            <p class="mt-2 text-sm text-gray-600">
              Passkey authenticates locally. Freighter signs the contract transaction with wallet key.
            </p>
          </div>

          <!-- Arrow -->
          <div class="hidden md:flex items-center justify-center">
            <div class="text-3xl text-indigo-400">‚Üí</div>
          </div>

          <!-- Step 4 -->
          <div class="relative">
            <div class="flex items-center justify-center h-12 w-12 rounded-md bg-yellow-600 text-white font-bold text-lg">
              4
            </div>
            <h3 class="mt-4 text-lg font-medium text-gray-900">Contract Verification</h3>
            <p class="mt-2 text-sm text-gray-600">
              Soroban's __check_auth verifies both passkey and wallet signatures. Transaction is approved!
            </p>
          </div>
        </div>
      </div>

      <!-- Feature Comparison -->
      <div class="mt-12 bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-6">üìä Feature Comparison</h2>
        
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-gray-50 border-b-2 border-gray-200">
              <tr>
                <th class="px-6 py-3 text-left font-semibold text-gray-900">Feature</th>
                <th class="px-6 py-3 text-left font-semibold text-gray-900">Passkey</th>
                <th class="px-6 py-3 text-left font-semibold text-gray-900">Freighter</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <tr>
                <td class="px-6 py-3 text-gray-900 font-medium">Authentication</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Local biometric</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Key-based</td>
              </tr>
              <tr class="bg-gray-50">
                <td class="px-6 py-3 text-gray-900 font-medium">Signs Transactions</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Via __check_auth</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Full XDR</td>
              </tr>
              <tr>
                <td class="px-6 py-3 text-gray-900 font-medium">No Passwords</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Yes</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Yes</td>
              </tr>
              <tr class="bg-gray-50">
                <td class="px-6 py-3 text-gray-900 font-medium">Cross-Device</td>
                <td class="px-6 py-3 text-yellow-600">‚ö†Ô∏è Limited</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Yes</td>
              </tr>
              <tr>
                <td class="px-6 py-3 text-gray-900 font-medium">Network Support</td>
                <td class="px-6 py-3 text-gray-600">Contract-based</td>
                <td class="px-6 py-3 text-green-600">‚úÖ Stellar testnet/mainnet</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Code Examples -->
      <div class="mt-12 bg-gray-900 rounded-lg shadow-lg p-8 text-gray-100">
        <h2 class="text-3xl font-bold mb-6">üíª Code Examples</h2>
        
        <div class="space-y-6">
          <!-- Example 1 -->
          <div>
            <h3 class="text-lg font-semibold mb-2 text-indigo-400">1. Register Passkey</h3>
            <pre class="bg-gray-800 p-4 rounded overflow-x-auto text-sm"><code>{`import { registerPasskey } from '../services/PasskeyService';

const result = await registerPasskey({
  id: 'user-123',
  name: 'John Doe',
  displayName: 'John'
});

console.log('Credential ID:', result.rawId);`}</code></pre>
          </div>

          <!-- Example 2 -->
          <div>
            <h3 class="text-lg font-semibold mb-2 text-blue-400">2. Connect Freighter</h3>
            <pre class="bg-gray-800 p-4 rounded overflow-x-auto text-sm"><code>{`import { freighterService } from '../services/FreighterService';

const result = await freighterService.connect();
if (result.success) {
  console.log('Public Key:', freighterService.publicKey);
  console.log('Network:', freighterService.networkDetails?.network);
}`}</code></pre>
          </div>

          <!-- Example 3 -->
          <div>
            <h3 class="text-lg font-semibold mb-2 text-orange-400">3. Sign a Transaction</h3>
            <pre class="bg-gray-800 p-4 rounded overflow-x-auto text-sm"><code>{`// After passkey auth + freighter connection
const { signed, error } = await freighterService.signTransaction(txXDR);

if (!error) {
  // Submit the signed transaction to Stellar
  const result = await submitTransaction(signed);
  console.log('Transaction hash:', result.id);
}`}</code></pre>
          </div>
        </div>
      </div>

      <!-- Getting Started -->
      <div class="mt-12 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-lg shadow-lg p-8 text-white">
        <h2 class="text-3xl font-bold mb-4">üöÄ Getting Started</h2>
        <ol class="space-y-3 text-lg">
          <li>
            <strong>1. Register a Passkey</strong> - Use the PasskeyConnector on the left to create your biometric key
          </li>
          <li>
            <strong>2. Connect Freighter</strong> - Use the WalletConnector on the right to authorize your wallet
          </li>
          <li>
            <strong>3. Read the Guide</strong> - Check <code class="bg-white bg-opacity-20 px-2 py-1 rounded">PASSKEY_INTEGRATION.md</code> for detailed instructions
          </li>
          <li>
            <strong>4. Deploy Contract</strong> - Deploy your Soroban contract with __check_auth support
          </li>
          <li>
            <strong>5. Integrate Voting</strong> - Use both services together in your voting flow
          </li>
        </ol>
      </div>

      <!-- Support -->
      <div class="mt-12 text-center text-gray-600">
        <p class="text-sm">
          Need help? Check the documentation at <code class="bg-gray-200 px-2 py-1 rounded">PASSKEY_INTEGRATION.md</code>
        </p>
        <p class="text-xs mt-4">
          Based on <a href="https://github.com/josealfredo79/passkeySoroban" class="text-indigo-600 hover:underline">passkeySoroban</a> reference implementation
        </p>
      </div>
    </div>
  </div>

  <style>
    :global(body) {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
  </style>
</Layout>
